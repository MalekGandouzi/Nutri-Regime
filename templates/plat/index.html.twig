{# templates/plat/index.html.twig #}
{% extends 'base.html.twig' %}

{% block title %}Plats & recettes
{% endblock %}

{% block body %}
	<div
		class="container py-4">

		{# Bandeau #}
		<section class="hero-banner p-4 p-md-5 mb-4">
			<div class="row align-items-center hero-content">
				<div class="col-md-7">
					<div class="nutri-pill mb-2">
						<i class="bi bi-bowl-salad"></i>
						Gestion des plats & recettes
					</div>
					<h1 class="h4 h-md-3 fw-bold mb-3">
						Des plats
						<span style="color: var(--nutri-green)">colorés</span>
						et
						<span class="text-warning">équilibrés</span>
						pour chaque régime.
					</h1>
					<p class="mb-3">
						Configure des recettes en précisant le coût, les calories et le régime associé.
												                    L’objectif : une base de données claire et appétissante.
					</p>
					<div class="d-flex flex-wrap gap-2">
						<a href="{{ path('admin_plat_add') }}" class="btn btn-nutri-main">
							<i class="bi bi-plus-circle me-1"></i>
							Ajouter un plat
						</a>
						<span class="nutri-pill">
							<i class="bi bi-basket"></i>
							{{ plats|length }}
							plat(s) enregistré(s)
						</span>
					</div>
				</div>
				<div class="col-md-5 text-center mt-3 mt-md-0">
					<img src="https://images.unsplash.com/photo-1512621776951-a57141f2eefd?auto=format&fit=crop&w=700&q=80" alt="Healthy bowl" class="img-fluid rounded-4 shadow-sm border border-white">
				</div>
			</div>
		</section>

		{# Liste des plats #}
		<section>
			<div class="d-flex justify-content-between align-items-center mb-3">
				<h2 class="h5 mb-0">
					<i class="bi bi-basket2-fill me-2"></i>
					Mes plats
				</h2>
				<a href="{{ path('admin_plat_add') }}" class="btn btn-outline-success btn-sm">
					<i class="bi bi-plus-lg me-1"></i>
					Nouveau plat
				</a>
			</div>

			{% if plats is empty %}
				<div class="alert alert-light border d-flex align-items-center" role="alert">
					<i class="bi bi-emoji-frown me-2 fs-4"></i>
					<div>
						Aucun plat pour le moment. Commence par
						<a href="{{ path('admin_plat_add') }}" class="fw-semibold text-success">ajouter un plat</a>.
					</div>
				</div>
			{% else %}
<div class="container py-4">
	<div class="row g-4">

		{% for plat in plats %}
			<div class="col-12 col-md-6 col-lg-4 d-flex">
				<div class="card nutri-card w-100 h-100">

					{% set imageUrl = plat.image
                        ? asset('uploads/' ~ plat.image)
                        : 'https://images.unsplash.com/photo-1504674900247-0877df9cc836?auto=format&fit=crop&w=900&q=80'
                    %}

					<img src="{{ imageUrl }}" class="card-img-top" style="height: 200px; object-fit: cover; border-radius: 12px 12px 0 0;">

					<div class="card-body d-flex flex-column">

						<h5 class="card-title mb-1">{{ plat.nomPlat }}</h5>

						<p class="text-muted small mb-1">
							<i class="bi bi-cash-stack me-1"></i>
							{{ plat.cout }}
							TND
						</p>

						<p class="text-muted small mb-2">
							<i class="bi bi-fire text-danger me-1"></i>
							{{ plat.nbrCalories }}
							kcal
						</p>

						<p class="small text-muted flex-grow-1">
							{{ plat.ingredients|slice(0, 70) ~ (plat.ingredients|length > 70 ? '...' : '') }}
						</p>

						<div class="d-flex justify-content-between align-items-center mt-auto">
							<div class="d-flex gap-1">

								<a href="{{ path('admin_plat_show', {id: plat.id}) }}" class="btn btn-sm btn-outline-secondary">
									<i class="bi bi-eye"></i>
								</a>

								<a href="{{ path('admin_plat_edit_all', {id: plat.id}) }}" class="btn btn-sm btn-outline-primary">
									<i class="bi bi-pencil-square"></i>
								</a>

								<form method="post" action="{{ path('admin_plat_delete', {id: plat.id}) }}" onsubmit="return confirm('Supprimer ce plat ?');">
									<input type="hidden" name="_token" value="{{ csrf_token('delete' ~ plat.id) }}">
									<button class="btn btn-sm btn-outline-danger">
										<i class="bi bi-trash3"></i>
									</button>
								</form>

							</div>

							<span class="nutri-pill">
								<i class="bi bi-activity"></i>
								{{ plat.nbrCalories }}
								kcal
							</span>
						</div>

					</div>
				</div>
			</div>
		{% endfor %}

	</div>
</div>


		{% endif %}
	</section>
</div>{% endblock %}
